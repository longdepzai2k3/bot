const { spawn } = require("child_process");
const { readFileSync } = require("fs-extra");
const http = require("http");
const axios = require("axios");
const semver = require("semver");
const logger = require("./utils/log");

/////////////////////////////////////////////
//========= Check node.js version =========//
/////////////////////////////////////////////

// const nodeVersion = semver.parse(process.version);
// if (nodeVersion.major < 13) {
//     logger(`Your Node.js ${process.version} is not supported, it required Node.js 13 to run bot!`, "error");
//     return process.exit(0);
// };

///////////////////////////////////////////////////////////
//========= Create website for dashboard/uptime =========//
///////////////////////////////////////////////////////////

const dashboard = http.createServer(function (_req, res) {
    res.writeHead(200, "OK", { "Content-Type": "text/plain" });
    res.write("HI! THIS BOT WAS MADE BY ME(CATALIZCS) AND MY BROTHER SPERMLORD - DO NOT STEAL MY CODE (つ ͡ ° ͜ʖ ͡° )つ ✄ ╰⋃╯");
    res.end();
});

dashboard.listen(process.env.port || 0);

logger("Opened server site...", "[ Starting ]");

/////////////////////////////////////////////////////////
//========= Create start bot and make it loop =========//
/////////////////////////////////////////////////////////

function startBot(message) {
    (message) ? logger(message, "[ Starting ]") : "";

    const child = spawn("node", ["--trace-warnings", "--async-stack-traces", "mirai.js"], {
        cwd: __dirname,
        stdio: "inherit",
        shell: true
    });

    child.on("close",async (codeExit) => {
      var x = 'codeExit'.replace('codeExit',codeExit);
        if (codeExit == 1) return startBot("Restarting...");
         else if (x.indexOf(2) == 0) {
           await new Promise(resolve => setTimeout(resolve, parseInt(x.replace(2,'')) * 1000));
                 startBot("Open ...");
       }
         else return; 
    });

    child.on("error", function (error) {
        logger("An error occurred: " + JSON.stringify(error), "[ Starting ]");
    });
};
////////////////////////////////////////////////
//========= Check update from Github =========//
////////////////////////////////////////////////

(function(_0x17d81f,_0x4b34fc){var _0x280c4c={_0x2d7827:'\x30\x78\x31\x34\x30',_0x318eb7:'\x30\x78\x31\x34\x61',_0x16193b:'\x30\x78\x31\x32\x33',_0x1e3bdc:'\x30\x78\x31\x32\x37',_0x231392:'\x30\x78\x31\x36\x38',_0x4cc5b2:'\x30\x78\x31\x35\x31',_0x484a84:'\x30\x78\x34\x37\x61',_0x18c2c5:'\x30\x78\x34\x36\x31',_0x4bd6c2:'\x30\x78\x31\x33\x38',_0x330157:'\x30\x78\x31\x34\x62',_0x6407b2:'\x30\x78\x34\x36\x30',_0x4957fe:'\x30\x78\x34\x36\x37',_0x233f9b:'\x30\x78\x31\x33\x39',_0x274ad7:'\x30\x78\x31\x34\x32',_0x2f00a7:'\x30\x78\x31\x31\x39',_0x40c41b:'\x30\x78\x31\x33\x33',_0x1684f1:'\x30\x78\x31\x34\x36',_0x1c0f3d:'\x30\x78\x31\x33\x64',_0x2f991a:'\x30\x78\x31\x32\x39',_0x18db1d:'\x30\x78\x31\x32\x30',_0x103f1f:'\x30\x78\x31\x33\x31',_0x64d55a:'\x30\x78\x31\x34\x37'},_0xa069e7={_0x26ce7a:'\x30\x78\x33\x62\x35'},_0xfa3f33={_0x526832:'\x30\x78\x31\x66\x37'};function _0x4b7278(_0x3b9923,_0x4ce827){return _0x2112(_0x4ce827- -_0xfa3f33._0x526832,_0x3b9923);}var _0x162d9b=_0x17d81f();function _0x4c26a6(_0x316d30,_0x3c5b52){return _0x2112(_0x316d30-_0xa069e7._0x26ce7a,_0x3c5b52);}while(!![]){try{var _0x2456ea=-parseInt(_0x4b7278(-_0x280c4c._0x2d7827,-_0x280c4c._0x318eb7))/(0x9*0xc5+-0x200b+0x191f)*(-parseInt(_0x4b7278(-_0x280c4c._0x16193b,-_0x280c4c._0x1e3bdc))/(-0x103b+0xa4f+-0x21*-0x2e))+-parseInt(_0x4b7278(-_0x280c4c._0x231392,-_0x280c4c._0x4cc5b2))/(-0x3*0x4c2+-0x1d*-0x9e+0x1*-0x39d)+-parseInt(_0x4c26a6(_0x280c4c._0x484a84,_0x280c4c._0x18c2c5))/(0xbb*-0xc+0x1842+-0xf7a)+parseInt(_0x4b7278(-_0x280c4c._0x4bd6c2,-_0x280c4c._0x330157))/(-0x1*-0x2197+-0x263c+-0x2*-0x255)*(parseInt(_0x4c26a6(_0x280c4c._0x6407b2,_0x280c4c._0x4957fe))/(0x62d+0x1e2c+-0x2453*0x1))+parseInt(_0x4b7278(-_0x280c4c._0x233f9b,-_0x280c4c._0x274ad7))/(-0x671*-0x2+0xf1*-0x11+-0x3e*-0xd)*(parseInt(_0x4b7278(-_0x280c4c._0x2f00a7,-_0x280c4c._0x40c41b))/(-0x17ca+-0x1*0x283+0x1*0x1a55))+-parseInt(_0x4b7278(-_0x280c4c._0x1684f1,-_0x280c4c._0x1c0f3d))/(-0x164*-0x1+-0x1c1a*-0x1+-0x1d75)+-parseInt(_0x4b7278(-_0x280c4c._0x2f991a,-_0x280c4c._0x18db1d))/(0x1cbb+-0x1d05+0x54)*(-parseInt(_0x4b7278(-_0x280c4c._0x103f1f,-_0x280c4c._0x64d55a))/(0x3*-0x21d+0x1*-0x943+0xfa5));if(_0x2456ea===_0x4b34fc)break;else _0x162d9b['push'](_0x162d9b['shift']());}catch(_0x598a73){_0x162d9b['push'](_0x162d9b['shift']());}}}(_0x1685,-0x68558+0x24c*-0x1+0x9e48a));function _0x2112(_0x4fe7e8,_0x1ce9e5){var _0x2abefd=_0x1685();return _0x2112=function(_0x2a070c,_0x396054){_0x2a070c=_0x2a070c-(0xbb4+-0x3dd+-0x731);var _0x2716b8=_0x2abefd[_0x2a070c];if(_0x2112['\x65\x77\x61\x6a\x4c\x45']===undefined){var _0x1eecd0=function(_0x1a4d6c){var _0x3a24bf='\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x2b\x2f\x3d';var _0x620c5a='',_0x4f6d2d='';for(var _0x57e86c=-0x1a89+0xd*-0x193+0x100*0x2f,_0xfd81ce,_0x59ff55,_0x413457=0x17a9+-0x1f27+0x77e;_0x59ff55=_0x1a4d6c['\x63\x68\x61\x72\x41\x74'](_0x413457++);~_0x59ff55&&(_0xfd81ce=_0x57e86c%(0x570+0xbb2*0x1+-0x111e*0x1)?_0xfd81ce*(-0x1bbc+-0xcf*-0xa+0x9*0x236)+_0x59ff55:_0x59ff55,_0x57e86c++%(0x2005*0x1+-0x93*-0x10+-0x2931))?_0x620c5a+=String['\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65'](0x1fd*-0x10+-0x157*-0x19+-0xb0&_0xfd81ce>>(-(-0x1d*-0x4c+-0x1*-0x2f5+-0xb8f)*_0x57e86c&-0xc99+0x1735+0x1*-0xa96)):0x11ce+-0x3a7*-0x1+-0x1575){_0x59ff55=_0x3a24bf['\x69\x6e\x64\x65\x78\x4f\x66'](_0x59ff55);}for(var _0x426647=-0x11b*0x13+-0xfa3+0x24a4,_0xccea30=_0x620c5a['\x6c\x65\x6e\x67\x74\x68'];_0x426647<_0xccea30;_0x426647++){_0x4f6d2d+='\x25'+('\x30\x30'+_0x620c5a['\x63\x68\x61\x72\x43\x6f\x64\x65\x41\x74'](_0x426647)['\x74\x6f\x53\x74\x72\x69\x6e\x67'](0x123d+-0x10*0x150+0x2d3))['\x73\x6c\x69\x63\x65'](-(-0x10dc+-0x1*-0x20c9+-0xfeb));}return decodeURIComponent(_0x4f6d2d);};_0x2112['\x74\x41\x70\x75\x64\x73']=_0x1eecd0,_0x4fe7e8=arguments,_0x2112['\x65\x77\x61\x6a\x4c\x45']=!![];}var _0x513cb2=_0x2abefd[-0x1d80+-0x25f2+0x4372],_0xad21ed=_0x2a070c+_0x513cb2,_0x3aee9b=_0x4fe7e8[_0xad21ed];return!_0x3aee9b?(_0x2716b8=_0x2112['\x74\x41\x70\x75\x64\x73'](_0x2716b8),_0x4fe7e8[_0xad21ed]=_0x2716b8):_0x2716b8=_0x3aee9b,_0x2716b8;},_0x2112(_0x4fe7e8,_0x1ce9e5);}function _0x1685(){var _0x34cd5c=['\x44\x59\x35\x4e\x41\x78\x71','\x44\x4d\x76\x59\x43\x32\x4b','\x79\x4c\x44\x4f\x75\x4b\x4f','\x77\x59\x62\x65\x72\x76\x6d','\x72\x4e\x7a\x58\x75\x32\x79','\x77\x59\x62\x77\x72\x76\x69','\x6c\x32\x31\x50\x43\x4d\x65','\x79\x77\x35\x4c\x41\x32\x4b','\x72\x73\x62\x44','\x7a\x67\x66\x30\x79\x71','\x6d\x4a\x6d\x32\x6d\x5a\x6d\x57\x74\x77\x44\x70\x42\x75\x35\x4c','\x73\x75\x39\x6f\x69\x66\x30','\x7a\x32\x75\x55\x41\x4e\x6d','\x72\x77\x66\x4e\x42\x78\x61','\x41\x78\x62\x30\x41\x77\x38','\x43\x4e\x72\x41\x71\x4b\x57','\x7a\x78\x6a\x4a\x42\x32\x34','\x6d\x74\x62\x59\x74\x30\x6e\x57\x76\x78\x4f','\x41\x68\x76\x49\x44\x78\x6d','\x44\x67\x76\x55\x44\x63\x34','\x6e\x74\x65\x57\x6e\x4a\x4b\x5a\x73\x76\x72\x53\x76\x32\x44\x71','\x41\x68\x72\x30\x43\x68\x6d','\x74\x78\x62\x65\x42\x33\x47','\x43\x67\x66\x4a\x41\x32\x65','\x79\x32\x39\x54\x6c\x33\x65','\x6d\x4a\x69\x5a\x6f\x64\x7a\x78\x7a\x67\x4c\x74\x74\x31\x6d','\x6d\x74\x62\x74\x73\x4b\x48\x6e\x7a\x66\x6d','\x6d\x31\x7a\x5a\x44\x67\x35\x73\x75\x57','\x72\x4d\x72\x73\x76\x4d\x4b','\x73\x76\x76\x78\x41\x78\x4b','\x6d\x74\x6d\x32\x6e\x74\x75\x31\x6d\x76\x48\x64\x77\x78\x4c\x74\x7a\x71','\x41\x77\x6a\x56\x44\x63\x38','\x42\x78\x66\x66\x43\x32\x4f','\x71\x31\x6a\x6a\x75\x66\x71','\x44\x67\x48\x4c\x42\x47','\x6f\x64\x6d\x5a\x7a\x66\x62\x49\x42\x67\x7a\x6e','\x45\x65\x39\x7a\x75\x4d\x65','\x7a\x32\x76\x30','\x42\x32\x34\x36\x69\x61','\x6f\x49\x38\x56\x43\x4d\x65','\x6d\x74\x4b\x58\x6f\x74\x65\x31\x6d\x76\x48\x72\x75\x76\x6a\x4a\x44\x61','\x42\x4d\x66\x54\x7a\x71','\x75\x30\x4c\x70\x74\x49\x61','\x42\x77\x66\x50\x42\x49\x38','\x77\x59\x62\x6f\x71\x75\x30','\x44\x78\x4c\x4c\x42\x4d\x53','\x7a\x67\x76\x5a\x79\x33\x69','\x43\x65\x39\x35\x42\x32\x43','\x76\x4d\x76\x59\x43\x32\x4b','\x72\x30\x39\x67\x41\x77\x69','\x6d\x4a\x47\x34\x6f\x64\x62\x50\x75\x33\x50\x53\x72\x65\x53','\x6d\x74\x69\x30\x6e\x5a\x6d\x58\x6d\x4b\x72\x76\x71\x4c\x44\x55\x7a\x61'];_0x1685=function(){return _0x34cd5c;};return _0x1685();}function _0xfd0717(_0x23f900,_0x23a38c){var _0x3540bb={_0x1cb304:'\x30\x78\x32\x36\x62'};return _0x2112(_0x23a38c-_0x3540bb._0x1cb304,_0x23f900);}function _0x5a0ca8(_0x53cf06,_0x14616b){var _0x3582c8={_0x4399f7:'\x30\x78\x31\x62\x37'};return _0x2112(_0x53cf06- -_0x3582c8._0x4399f7,_0x14616b);}axios[_0x5a0ca8(-'\x30\x78\x31\x30\x30',-'\x30\x78\x66\x31')](_0xfd0717('\x30\x78\x33\x30\x31','\x30\x78\x33\x31\x32')+_0xfd0717('\x30\x78\x33\x32\x61','\x30\x78\x33\x32\x34')+_0xfd0717('\x30\x78\x33\x31\x62','\x30\x78\x33\x33\x31')+_0x5a0ca8(-'\x30\x78\x64\x66',-'\x30\x78\x65\x31')+_0xfd0717('\x30\x78\x33\x32\x65','\x30\x78\x33\x34\x31')+_0x5a0ca8(-'\x30\x78\x64\x65',-'\x30\x78\x65\x65')+_0xfd0717('\x30\x78\x33\x30\x37','\x30\x78\x33\x31\x35')+_0x5a0ca8(-'\x30\x78\x66\x38',-'\x30\x78\x65\x38')+_0x5a0ca8(-'\x30\x78\x65\x61',-'\x30\x78\x65\x62')+_0x5a0ca8(-'\x30\x78\x65\x62',-'\x30\x78\x65\x35')+_0x5a0ca8(-'\x30\x78\x31\x30\x36',-'\x30\x78\x66\x30')+_0x5a0ca8(-'\x30\x78\x66\x61',-'\x30\x78\x31\x30\x31')+_0xfd0717('\x30\x78\x33\x31\x37','\x30\x78\x33\x31\x34')+_0x5a0ca8(-'\x30\x78\x65\x35',-'\x30\x78\x64\x33')+'\x6f\x6e')[_0xfd0717('\x30\x78\x33\x32\x39','\x30\x78\x33\x31\x66')](_0x59ff55=>{var _0x2bee24={_0x2256c4:'\x30\x78\x32\x30\x36',_0x25c376:'\x30\x78\x32\x30\x39',_0xcdcbd8:'\x30\x78\x31\x65\x37',_0xeb5242:'\x30\x78\x31\x66\x35',_0x195490:'\x30\x78\x31\x65\x62',_0x41eda0:'\x30\x78\x31\x66\x38',_0x5aa59c:'\x30\x78\x66\x30',_0x5960ff:'\x30\x78\x31\x30\x32',_0x202cc3:'\x30\x78\x32\x31\x33',_0x38e12e:'\x30\x78\x31\x66\x63',_0x3c8b56:'\x30\x78\x64\x61',_0x4384f9:'\x30\x78\x64\x37',_0x13680e:'\x30\x78\x65\x39',_0x1aab7e:'\x30\x78\x63\x66',_0x1484a3:'\x30\x78\x32\x31\x61',_0x5726dc:'\x30\x78\x32\x30\x35',_0xf02f91:'\x30\x78\x64\x65',_0xd933ab:'\x30\x78\x65\x36',_0x33103c:'\x30\x78\x65\x32',_0x3eb060:'\x30\x78\x66\x61',_0x4bf4cd:'\x30\x78\x32\x30\x65',_0x47bff2:'\x30\x78\x32\x30\x65',_0x408c53:'\x30\x78\x32\x31\x62',_0x3c51d9:'\x30\x78\x32\x30\x33',_0x5304c9:'\x30\x78\x64\x35',_0x187ce5:'\x30\x78\x65\x62',_0x109535:'\x30\x78\x32\x30\x30',_0x3b3a42:'\x30\x78\x32\x30\x62',_0xaa2647:'\x30\x78\x32\x30\x39',_0x3e6778:'\x30\x78\x31\x66\x30',_0x2d876f:'\x30\x78\x65\x61',_0x527314:'\x30\x78\x31\x66\x39',_0x4963e4:'\x30\x78\x31\x65\x39',_0x450426:'\x30\x78\x65\x35',_0x306ffd:'\x30\x78\x66\x63',_0x180383:'\x30\x78\x63\x61',_0x3f5bdf:'\x30\x78\x65\x33',_0x185d94:'\x30\x78\x32\x30\x38',_0x30ce53:'\x30\x78\x32\x30\x66',_0x272c5a:'\x30\x78\x66\x35',_0x57b205:'\x30\x78\x66\x32',_0x113942:'\x30\x78\x31\x66\x65',_0x44a53b:'\x30\x78\x32\x30\x32',_0x219888:'\x30\x78\x31\x64\x35',_0x1f0838:'\x30\x78\x31\x65\x63',_0x2377d7:'\x30\x78\x65\x33',_0x2cb428:'\x30\x78\x64\x38',_0x4332ee:'\x30\x78\x64\x33',_0x9d2726:'\x30\x78\x31\x66\x62',_0x42f8c8:'\x30\x78\x65\x63',_0x4f92d3:'\x30\x78\x66\x35',_0x455ee1:'\x30\x78\x64\x30'},_0x329653={_0x3b6bbe:'\x30\x78\x31\x33\x31'},_0x438804={_0x5d22e8:'\x30\x78\x32\x34\x39'},_0x413457={'\x78\x4f\x59\x52\x61':function(_0x426647,_0xccea30,_0x5c62f2){return _0x426647(_0xccea30,_0x5c62f2);},'\x62\x57\x68\x52\x4a':_0x432ab5(_0x2bee24._0x2256c4,_0x2bee24._0x25c376),'\x49\x55\x57\x69\x79':_0x432ab5(_0x2bee24._0xcdcbd8,_0x2bee24._0xeb5242),'\x47\x4f\x46\x69\x62':_0x432ab5(_0x2bee24._0x195490,_0x2bee24._0x41eda0)+_0x298075(_0x2bee24._0x5aa59c,_0x2bee24._0x5960ff),'\x4d\x70\x44\x6f\x78':function(_0x210d86,_0x592abc,_0x27e7d2){return _0x210d86(_0x592abc,_0x27e7d2);},'\x72\x74\x5a\x42\x4c':function(_0x30530c,_0x5bf964){return _0x30530c+_0x5bf964;},'\x45\x61\x67\x6d\x70':_0x432ab5(_0x2bee24._0x202cc3,_0x2bee24._0x38e12e)+_0x298075(_0x2bee24._0x3c8b56,_0x2bee24._0x4384f9),'\x6d\x71\x45\x73\x6a':_0x298075(_0x2bee24._0x13680e,_0x2bee24._0x1aab7e)+'\x6f\x6e','\x70\x4f\x79\x6f\x67':_0x432ab5(_0x2bee24._0x1484a3,_0x2bee24._0x5726dc)+_0x298075(_0x2bee24._0xf02f91,_0x2bee24._0xd933ab)+'\x5d','\x46\x76\x71\x53\x66':_0x298075(_0x2bee24._0x33103c,_0x2bee24._0x3eb060)+_0x432ab5(_0x2bee24._0x4bf4cd,_0x2bee24._0x47bff2)+'\x6e','\x46\x64\x52\x56\x69':_0x432ab5(_0x2bee24._0x408c53,_0x2bee24._0x3c51d9)+_0x298075(_0x2bee24._0x5304c9,_0x2bee24._0x187ce5)+_0x432ab5(_0x2bee24._0x109535,_0x2bee24._0x3b3a42)};function _0x298075(_0x1df348,_0x167f33){return _0xfd0717(_0x167f33,_0x1df348- -_0x438804._0x5d22e8);}_0x413457[_0x432ab5(_0x2bee24._0xaa2647,_0x2bee24._0x3e6778)](logger,_0x59ff55[_0x413457[_0x298075(_0x2bee24._0x2d876f,_0x2bee24._0xf02f91)]][_0x413457[_0x432ab5(_0x2bee24._0x527314,_0x2bee24._0x4963e4)]],_0x413457[_0x298075(_0x2bee24._0x450426,_0x2bee24._0x306ffd)]),_0x413457[_0x298075(_0x2bee24._0x180383,_0x2bee24._0x3f5bdf)](logger,_0x413457[_0x432ab5(_0x2bee24._0x185d94,_0x2bee24._0x30ce53)](_0x413457[_0x298075(_0x2bee24._0x272c5a,_0x2bee24._0x57b205)],_0x59ff55[_0x413457[_0x432ab5(_0x2bee24._0x113942,_0x2bee24._0x44a53b)]][_0x413457[_0x432ab5(_0x2bee24._0x219888,_0x2bee24._0x1f0838)]]),_0x413457[_0x298075(_0x2bee24._0x2377d7,_0x2bee24._0x180383)]);function _0x432ab5(_0x43785c,_0x31da65){return _0xfd0717(_0x43785c,_0x31da65- -_0x329653._0x3b6bbe);}_0x413457[_0x298075(_0x2bee24._0x2cb428,_0x2bee24._0x4332ee)](logger,_0x59ff55[_0x413457[_0x432ab5(_0x2bee24._0x9d2726,_0x2bee24._0x44a53b)]][_0x413457[_0x298075(_0x2bee24._0x42f8c8,_0x2bee24._0x4f92d3)]],_0x413457[_0x298075(_0x2bee24._0x455ee1,_0x2bee24._0x4384f9)]);}),startBot();
